{
    "Description": "Redis Benchmark",
    "Metadata": {
        "RecommendedMinimumExecutionTime": "02:00:00",
        "SupportedPlatforms": "linux-x64,linux-arm64",
        "SupportedOperatingSystems": "Ubuntu"
    },
    "Parameters": {
        "ServerPort": 6379
    },
    "Actions": [
        {
            "Type": "RedisServerExecutor",
            "Parameters": {
                "Scenario": "Server",
                "Role": "Server",
                "Port": "$.Parameters.ServerPort",
                "PackageName": "redis",
                "BenchmarkPackageName": "memtier",
                "Bind": 1
            }
        },
        {
            "Type": "RedisMemtierClientExecutor",
            "Parameters": {
                "Scenario": "Memtier_4t_1c",
                "Role": "Client",
                "Port": "$.Parameters.ServerPort",
                "PackageName": "memtier",
                "ThreadCount": 4,
                "ClientsPerThread": 1,
                "RunCount": 1,
                "Duration": "00:03:00",
                "Protocol": "redis",
                "PipelineDepth": 32
            }
        },
        {
            "Type": "RedisMemtierClientExecutor",
            "Parameters": {
                "Scenario": "Memtier_4t_2c",
                "Role": "Client",
                "Port": "$.Parameters.ServerPort",
                "PackageName": "memtier",
                "ThreadCount": 4,
                "ClientsPerThread": 2,
                "RunCount": 1,
                "Duration": "00:03:00",
                "Protocol": "redis",
                "PipelineDepth": 32
            }
        },
        {
            "Type": "RedisMemtierClientExecutor",
            "Parameters": {
                "Scenario": "Memtier_4t_8c",
                "Role": "Client",
                "Port": "$.Parameters.ServerPort",
                "PackageName": "memtier",
                "ThreadCount": 4,
                "ClientsPerThread": 4,
                "RunCount": 1,
                "Duration": "00:03:00",
                "Protocol": "redis",
                "PipelineDepth": 32
            }
        },
        {
            "Type": "RedisMemtierClientExecutor",
            "Parameters": {
                "Scenario": "Memtier_4t_16c",
                "Role": "Client",
                "Port": "$.Parameters.ServerPort",
                "PackageName": "memtier",
                "ThreadCount": 4,
                "ClientsPerThread": 8,
                "RunCount": 1,
                "Duration": "00:03:00",
                "Protocol": "redis",
                "PipelineDepth": 32
            }
        },
        {
            "Type": "RedisMemtierClientExecutor",
            "Parameters": {
                "Scenario": "Memtier_16t_1c",
                "Role": "Client",
                "Port": "$.Parameters.ServerPort",
                "PackageName": "memtier",
                "ThreadCount": 16,
                "ClientsPerThread": 1,
                "RunCount": 1,
                "Duration": "00:03:00",
                "Protocol": "redis",
                "PipelineDepth": 32
            }
        },
        {
            "Type": "RedisMemtierClientExecutor",
            "Parameters": {
                "Scenario": "Memtier_16t_2c",
                "Role": "Client",
                "Port": "$.Parameters.ServerPort",
                "PackageName": "memtier",
                "ThreadCount": 16,
                "ClientsPerThread": 2,
                "RunCount": 1,
                "Duration": "00:03:00",
                "Protocol": "redis",
                "PipelineDepth": 32
            }
        },
        {
            "Type": "RedisMemtierClientExecutor",
            "Parameters": {
                "Scenario": "Memtier_16t_4c",
                "Role": "Client",
                "Port": "$.Parameters.ServerPort",
                "PackageName": "memtier",
                "ThreadCount": 16,
                "ClientsPerThread": 4,
                "RunCount": 1,
                "Duration": "00:03:00",
                "Protocol": "redis",
                "PipelineDepth": 32
            }
        },
        {
            "Type": "RedisMemtierClientExecutor",
            "Parameters": {
                "Scenario": "Memtier_16t_8c",
                "Role": "Client",
                "Port": "$.Parameters.ServerPort",
                "PackageName": "memtier",
                "ThreadCount": 16,
                "ClientsPerThread": 8,
                "RunCount": 1,
                "Duration": "00:03:00",
                "Protocol": "redis",
                "PipelineDepth": 32
            }
        },
        {
            "Type": "RedisBenchmarkClientExecutor",
            "Parameters": {
                "Scenario": "RedisBenchmark_10kreq_1c",
                "Role": "Client",
                "Port": "$.Parameters.ServerPort",
                "PackageName": "redis",
                "ClientsPerThread": 1,
                "RequestCount": 10000,
                "PipelineDepth": 32
            }
        },
        {
            "Type": "RedisBenchmarkClientExecutor",
            "Parameters": {
                "Scenario": "RedisBenchmark_10kreq_2c",
                "Role": "Client",
                "Port": "$.Parameters.ServerPort",
                "PackageName": "redis",
                "ClientsPerThread": 2,
                "RequestCount": 10000,
                "PipelineDepth": 32
            }
        },
        {
            "Type": "RedisBenchmarkClientExecutor",
            "Parameters": {
                "Scenario": "RedisBenchmark_10kreq_4c",
                "Role": "Client",
                "Port": "$.Parameters.ServerPort",
                "PackageName": "redis",
                "ClientsPerThread": 4,
                "RequestCount": 10000,
                "PipelineDepth": 32
            }
        },
        {
            "Type": "RedisBenchmarkClientExecutor",
            "Parameters": {
                "Scenario": "RedisBenchmark_10kreq_8c",
                "Role": "Client",
                "Port": "$.Parameters.ServerPort",
                "PackageName": "redis",
                "ClientsPerThread": 8,
                "RequestCount": 10000,
                "PipelineDepth": 32
            }
        },
        {
            "Type": "RedisBenchmarkClientExecutor",
            "Parameters": {
                "Scenario": "RedisBenchmark_50kreq_1c",
                "Role": "Client",
                "Port": "$.Parameters.ServerPort",
                "PackageName": "redis",
                "ClientsPerThread": 1,
                "RequestCount": 50000,
                "PipelineDepth": 32
            }
        },
        {
            "Type": "RedisBenchmarkClientExecutor",
            "Parameters": {
                "Scenario": "RedisBenchmark_50kreq_2c",
                "Role": "Client",
                "Port": "$.Parameters.ServerPort",
                "PackageName": "redis",
                "ClientsPerThread": 2,
                "RequestCount": 50000,
                "PipelineDepth": 32
            }
        },
        {
            "Type": "RedisBenchmarkClientExecutor",
            "Parameters": {
                "Scenario": "RedisBenchmark_50kreq_4c",
                "Role": "Client",
                "Port": "$.Parameters.ServerPort",
                "PackageName": "redis",
                "ClientsPerThread": 4,
                "RequestCount": 50000,
                "PipelineDepth": 32
            }
        },
        {
            "Type": "RedisBenchmarkClientExecutor",
            "Parameters": {
                "Scenario": "RedisBenchmark_50kreq_8c",
                "Role": "Client",
                "Port": "$.Parameters.ServerPort",
                "PackageName": "redis",
                "ClientsPerThread": 8,
                "RequestCount": 50000,
                "PipelineDepth": 32
            }
        }
    ],
    "Dependencies": [
        {
            "Type": "LinuxPackageInstallation",
            "Parameters": {
                "Scenario": "InstallLinuxPackages",
                "Packages-Apt": "build-essential,libevent-dev,pkg-config,zlib1g-dev,libssl-dev,autoconf,automake,libpcre3-dev",
                "Packages-Yum": "zlib-devel,pcre-devel,libevent-devel,openssl-devel,git,gcc-c++,make,autoconf,automake",
                "Packages-Dnf": "zlib-devel,pcre-devel,libevent-devel,openssl-devel,git,gcc-c++,make,autoconf,automake"
            }
        },
        {
            "Type": "LinuxPackageInstallation",
            "Parameters": {
                "Scenario": "InstallLinuxPackages",
                "Packages-Apt": "wget,build-essential,tcl-dev,numactl",
                "Packages-Yum": "wget,numactl,tcl-devel",
                "Packages-Dnf": "wget,numactl,tcl-devel"
            }
        },
        {
            "Type": "WgetPackageInstallation",
            "Parameters": {
                "Scenario": "InstallRedis",
                "PackageName": "redis",
                "PackageUri": "https://github.com/redis/redis/archive/refs/tags/6.2.1.tar.gz"
            }
        },
        {
            "Type": "ExecutePackageCommand",
            "Parameters": {
                "Scenario": "CompileRedis",
                "PlatformArchitecture": "linux-x64,linux-arm64",
                "Command": "./configure&&make",
                "PackageName": "redis"
            }
        },
        {
            "Type": "CloneRepo",
            "Parameters": {
                "Scenario": "InstallMemtier",
                "RepoUri": "https://github.com/RedisLabs/memtier_benchmark",
                "PackageName": "memtier"
            }
        },
        {
            "Type": "ExecutePackageCommand",
            "Parameters": {
                "Scenario": "CompileMemtier",
                "PlatformArchitecture": "linux-x64,linux-arm64",
                "Command": "git checkout 1.4.0&&autoreconf -ivf&&./configure&&make",
                "PackageName": "memtier"
            }
        },
        {
            "Type": "ApiServer",
            "Parameters": {
                "Scenario": "StartAPIServer"
            }
        }
    ]
}