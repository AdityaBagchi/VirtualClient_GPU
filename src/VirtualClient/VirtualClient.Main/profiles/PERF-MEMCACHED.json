{
    "Description": "Memcached Benchmark",
    "Metadata": {
        "RecommendedMinimumExecutionTime": "01:00:00",
        "SupportedPlatforms": "linux-x64,linux-arm64",
        "SupportedOperatingSystems": "Ubuntu"
    },
    "Parameters": {
        "ServerPort": 6379,
        "ServerMemoryCacheSizeInMB": 1024,
        "Username": "username"
    },
    "Actions": [
        {
            "Type": "MemcachedMemtierServerExecutor",
            "Parameters": {
                "Scenario": "Server",
                "PackageName": "memcached",
                "BenchmarkPackageName": "memtier",
                "Role": "Server",
                "Port": "$.Parameters.ServerPort",
                "Bind": 1,
                "Username": "$.Parameters.Username",
                "ServerMemoryCacheSizeInMB": "$.Parameters.ServerMemoryCacheSizeInMB"
            }
        },
        {
            "Type": "MemcachedMemtierClientExecutor",
            "Parameters": {
                "Scenario": "Memtier_4t_1c",
                "PackageName": "memtier",
                "Role": "Client",
                "ThreadCount": 4,
                "ClientsPerThread": 1,
                "RunCount": 1,
                "Duration": "00:03:00",
                "PipelineDepth": 32,
                "Port": "$.Parameters.ServerPort",
                "Protocol": "memcache_text",
                "Username": "$.Parameters.Username"
            }
        },
        {
            "Type": "MemcachedMemtierClientExecutor",
            "Parameters": {
                "Scenario": "Memtier_4t_2c",
                "PackageName": "memtier",
                "Role": "Client",
                "ThreadCount": 4,
                "ClientsPerThread": 2,
                "RunCount": 1,
                "Duration": "00:03:00",
                "PipelineDepth": 32,
                "Port": "$.Parameters.ServerPort",
                "Protocol": "memcache_text",
                "Username": "$.Parameters.Username"
            }
        },
        {
            "Type": "MemcachedMemtierClientExecutor",
            "Parameters": {
                "Scenario": "Memtier_4t_4c",
                "PackageName": "memtier",
                "Role": "Client",
                "ThreadCount": 4,
                "ClientsPerThread": 4,
                "RunCount": 1,
                "Duration": "00:03:00",
                "PipelineDepth": 32,
                "Port": "$.Parameters.ServerPort",
                "Protocol": "memcache_text",
                "Username": "$.Parameters.Username"
            }
        },
        {
            "Type": "MemcachedMemtierClientExecutor",
            "Parameters": {
                "Scenario": "Memtier_8t_2c",
                "PackageName": "memtier",
                "Role": "Client",
                "ThreadCount": 8,
                "ClientsPerThread": 2,
                "RunCount": 1,
                "Duration": "00:03:00",
                "PipelineDepth": 32,
                "Port": "$.Parameters.ServerPort",
                "Protocol": "memcache_text",
                "Username": "$.Parameters.Username"
            }
        },
        {
            "Type": "MemcachedMemtierClientExecutor",
            "Parameters": {
                "Scenario": "Memtier_8t_4c",
                "PackageName": "memtier",
                "Role": "Client",
                "ThreadCount": 8,
                "ClientsPerThread": 4,
                "RunCount": 1,
                "Duration": "00:03:00",
                "PipelineDepth": 32,
                "Port": "$.Parameters.ServerPort",
                "Protocol": "memcache_text",
                "Username": "$.Parameters.Username"
            }
        },
        {
            "Type": "MemcachedMemtierClientExecutor",
            "Parameters": {
                "Scenario": "Memtier_8t_8c",
                "PackageName": "memtier",
                "Role": "Client",
                "ThreadCount": 8,
                "ClientsPerThread": 8,
                "RunCount": 1,
                "Duration": "00:03:00",
                "PipelineDepth": 32,
                "Port": "$.Parameters.ServerPort",
                "Protocol": "memcache_text",
                "Username": "$.Parameters.Username"
            }
        },
        {
            "Type": "MemcachedMemtierClientExecutor",
            "Parameters": {
                "Scenario": "Memtier_16t_4c",
                "PackageName": "memtier",
                "Role": "Client",
                "ThreadCount": 16,
                "ClientsPerThread": 4,
                "RunCount": 1,
                "Duration": "00:03:00",
                "PipelineDepth": 32,
                "Port": "$.Parameters.ServerPort",
                "Protocol": "memcache_text",
                "Username": "$.Parameters.Username"
            }
        },
        {
            "Type": "MemcachedMemtierClientExecutor",
            "Parameters": {
                "Scenario": "Memtier_16t_8c",
                "PackageName": "memtier",
                "Role": "Client",
                "ThreadCount": 16,
                "ClientsPerThread": 8,
                "RunCount": 1,
                "Duration": "00:03:00",
                "PipelineDepth": 32,
                "Port": "$.Parameters.ServerPort",
                "Protocol": "memcache_text",
                "Username": "$.Parameters.Username"
            }
        },
        {
            "Type": "MemcachedMemtierClientExecutor",
            "Parameters": {
                "Scenario": "Memtier_16t_16c",
                "PackageName": "memtier",
                "Role": "Client",
                "ThreadCount": 16,
                "ClientsPerThread": 16,
                "RunCount": 1,
                "Duration": "00:03:00",
                "PipelineDepth": 32,
                "Port": "$.Parameters.ServerPort",
                "Protocol": "memcache_text",
                "Username": "$.Parameters.Username"
            }
        }
    ],
    "Dependencies": [
        {
            "Type": "LinuxPackageInstallation",
            "Parameters": {
                "Scenario": "InstallLinuxPackages",
                "Packages-Apt": "autoconf,automake,libpcre3-dev,libevent-dev,zlib1g-dev,libssl-dev,pkg-config,build-essential",
                "Packages-Yum": "autoconf,automake,pcre-devel,libevent-devel,zlib-devel,openssl-devel,make,gcc-c++,git",
                "Packages-Dnf": "autoconf,automake,pcre-devel,libevent-devel,zlib-devel,openssl-devel,make,gcc-c++,git"
            }
        },
        {
            "Type": "LinuxPackageInstallation",
            "Parameters": {
                "Scenario": "InstallLinuxPackages",
                "Packages-Apt": "tcl-dev,numactl",
                "Packages-Yum": "tcl-devel,numactl",
                "Packages-Dnf": "tcl-devel,numactl"
            }
        },
        {
            "Type": "WgetPackageInstallation",
            "Parameters": {
                "Scenario": "InstallMemcached",
                "PackageName": "memcached",
                "PackageUri": "https://memcached.org/files/memcached-1.6.17.tar.gz",
                "Role": "Server"
            }
        },
        {
            "Type": "ExecutePackageCommand",
            "Parameters": {
                "Scenario": "CompileMemcached",
                "PlatformArchitecture": "linux-x64,linux-arm64",
                "Command": "./configure&&make",
                "PackageName": "memcached",
                "Role": "Server"
            }
        },
        {
            "Type": "CloneRepo",
            "Parameters": {
                "Scenario": "InstallMemtier",
                "RepoUri": "https://github.com/RedisLabs/memtier_benchmark",
                "PackageName": "memtier"
            }
        },
        {
            "Type": "ExecutePackageCommand",
            "Parameters": {
                "Scenario": "Memtier",
                "PlatformArchitecture": "linux-x64,linux-arm64",
                "Command": "git checkout 1.4.0&&autoreconf -ivf&&./configure&&make",
                "PackageName": "memtier"
            }
        },
        {
            "Type": "ApiServer",
            "Parameters": {
                "Scenario": "StartAPIServer"
            }
        }
    ]
}